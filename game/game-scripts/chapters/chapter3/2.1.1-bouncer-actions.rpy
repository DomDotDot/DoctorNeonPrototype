# --- ПАЗЛ "РАЗГНЕВАЙ ГИГАНТА" ---

label ch3_provoke_verbal:
    # Шаг 1: Словесная провокация из V2
    if provocation_count >= 1:
        "Вышибала" "Еще раз подойдешь, и я тебе язык вырву."
        jump ch3_hall_explore

    "Вышибала" "Чего уставилась, умница?"
    neon "Просто провожу наблюдение. Хочу проверить гипотезу: ваша мышечная масса обратно пропорциональна скорости нейронной реакции? Судя по вашему выражению лица, я на верном пути."
    "Вышибала" "(Хмурится) Чего? Кончай умничать, а то я тебе твою гипотезу в глотку засуну."
    narrator "Он явно разозлился. Отлично. Первый шаг сделан."
    $ provocation_count += 1
    jump ch3_hall_explore

# Добавим сюда другие способы провокации, которые можно найти в холле
# Например, можно вернуться к решетке и сорвать афиши (идея из V1)

# menu:
#    "Сорвать афиши с доски объявлений." if hall_examined and provocation_count == 1:
#        # Шаг 2: Физическая провокация
#        narrator "Справа от ворот висит доска объявлений, пестрящая афишами. Я подхожу и с яростью срываю их, комкая в руках. Звук рвущейся бумаги разносится по холлу."
#        "Вышибала" "Эй, ты! Что ты там делаешь?! Прекращай уже!" with vpunch
#        narrator "Его голос полон нескрываемого раздражения. Еще немного..."
#        $ provocation_count += 1
#        jump ch3_hall_explore

#    "Толкнуть шаткий шкаф." if hall_examined and provocation_count == 2:
#        # Шаг 3: Финальная провокация, запускающая погоню
#        narrator "Это будет последней каплей. Я подхожу к шаткому шкафчику и, сделав вид, что споткнулась, со всей силы толкаю его."
#        # play sound "sounds/metal_cabinet_crash_loud.ogg"
#        narrator "Шкаф с оглушительным грохотом накренился и ударился о стену."
#        "Вышибала" "ВСЕ! ТЫ ДОИГРАЛАСЬ, УМНИЦА!"
#        narrator "Он сорвался с места и бросился прямо на меня."
#        jump ch3_chase_start

# --- СЦЕНА ПОГОНИ (из V2) ---

label ch3_chase_start:
    # Проверка, чтобы игрок не попал сюда случайно
    if provocation_count < 3: # Увеличим порог до 3 провокаций
        narrator "Нужно еще что-то сделать, чтобы вывести его из себя."
        jump ch3_hall_explore

    # music "sounds/chase_theme_factory.ogg" loop
    narrator "Он бежал на меня, как разъяренный бык. Нужно было решать, куда бежать!"

    menu:
        "К выходу!":
            narrator "Я бросилась к выходу, но он был быстрее. Он схватил меня за плечо..."
            jump game_over_bouncer # Сцена проигрыша

        "К тому шкафчику, который я толкнула!":
            narrator """
            Я рванула в угол, к шатающемуся шкафчику. Он несся за мной, его тяжелые шаги отдавались гулким эхом по всему холлу.
            
            В последний момент я резко присела, проскальзывая мимо шкафа.
            """
            # play sound "sounds/body_slide_floor.ogg"
            narrator "Вышибала, замахнувшись для удара, промахнулся. Его огромный кулак со всей силы врезался в дверцу шкафчика."
            # play sound "sounds/metal_punch_dent_door_bust.ogg"
            narrator "Раздался оглушительный треск металла. Дверца, не выдержав такого удара, отлетела в сторону."
            jump ch3_bouncer_success

# --- ЗАВЕРШЕНИЕ СЦЕНЫ ---

label ch3_bouncer_success:
    # Комбинация концовок из V1 и V2
    "Вышибала" """
    Ну ладно... черт с тобой.

    Надеюсь, ты уяснила, что так делать не стоит.
    
    А иначе ты будешь как этот шкаф.
    """
    # play sound "sounds/kick_metal.ogg" with vpunch
    narrator "Он брезгливо пнул шкаф носком тяжелого ботинка и, бормоча ругательства, вернулся на свой пост у входа."
    
    $ locker_broken = True
    narrator "Он ушел. А я осталась стоять у разбитого шкафа, в котором теперь зияла дыра... и возможность."
    jump ch3_cabinet_door

    label game_over_bouncer:
    stop music
    stop ambient
    scene black with dissolve
    "Вышибала" "Попалась." with vpunch
    call chapter3_part1_start
    return